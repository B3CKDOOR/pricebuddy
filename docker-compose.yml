services:

    app:
        build:
            context: .
            dockerfile: docker/php.dockerfile
        image: jez500/pricebuddy:latest
        ports:
            - 8080:80
        volumes:
            - storage:/app/storage
            - ./.env:/app/.env
        env_file:
          - .env
        depends_on:
          database:
            condition: service_healthy
        networks:
            - default

    database:
        image: mysql:8.2
        env_file:
          - .env
        healthcheck:
          test: [ "CMD", "mysqladmin", "ping", "-h", "localhost", "-u${MYSQL_USER}", "-p${MYSQL_PASSWORD}" ]
          interval: 10s
          timeout: 5s
          retries: 5
        volumes:
            - database:/var/lib/mysql
        networks:
            - default

    scraper:
        image: amerkurev/scrapper:latest
        networks:
            - default
        ports:
            - 3030:3000 # Optional, if you want to access the scrapper api from the host machine

volumes:
    storage:
    database:

networks:
    default:
